<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Constraints and SMC · NPDemand</title><meta name="title" content="Constraints and SMC · NPDemand"/><meta property="og:title" content="Constraints and SMC · NPDemand"/><meta property="twitter:title" content="Constraints and SMC · NPDemand"/><meta name="description" content="Documentation for NPDemand."/><meta property="og:description" content="Documentation for NPDemand."/><meta property="twitter:description" content="Documentation for NPDemand."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">NPDemand</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">NPDemand.jl</a></li><li><span class="tocitem">Implementation Details</span><ul><li><a class="tocitem" href="../details/">Setup and GMM</a></li><li><a class="tocitem" href="../priors/">Quasibayes: Priors and Sampling</a></li><li class="is-active"><a class="tocitem" href>Constraints and SMC</a><ul class="internal"><li><a class="tocitem" href="#Constraints"><span>Constraints</span></a></li></ul></li></ul></li><li><span class="tocitem">Usage</span><ul><li><a class="tocitem" href="../usage/">Basic Usage (GMM)</a></li><li><a class="tocitem" href="../quasibayes_usage/">Using Quasi-Bayes Tools</a></li></ul></li><li><a class="tocitem" href="../postestimation/">Post-Estimation</a></li><li><a class="tocitem" href="../functions/">Function Documentation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Implementation Details</a></li><li class="is-active"><a href>Constraints and SMC</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Constraints and SMC</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/jamesbrandecon/NPDemand.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/jamesbrandecon/NPDemand.jl/blob/master/docs/src/constraints.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="Constraints"><a class="docs-heading-anchor" href="#Constraints">Constraints</a><a id="Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Constraints" title="Permalink"></a></h2><p>Below is a list of constraints which have been implemented in NPDemand so far. We impose these constraints on our nonparametric demand functions in two ways: one which is linear in parameters, and another which requires quasi-Bayes sampling over our objective function. We discuss both approaches below. </p><table><tr><th style="text-align: right">Constraint</th><th style="text-align: right">Symbol</th><th style="text-align: right">Linear constraint</th></tr><tr><td style="text-align: right">Negative own-price elasticities</td><td style="text-align: right">:monotone</td><td style="text-align: right">Yes</td></tr><tr><td style="text-align: right">Diagonal Dominance within exchangeable groups</td><td style="text-align: right">:diagonal_dominance_in_group</td><td style="text-align: right">Yes</td></tr><tr><td style="text-align: right">Diagonal Dominance among all products</td><td style="text-align: right">:diagonal_dominance_all</td><td style="text-align: right">Yes</td></tr><tr><td style="text-align: right">All products substitutes</td><td style="text-align: right">:all_substitutes</td><td style="text-align: right">Yes</td></tr><tr><td style="text-align: right">Products in the same group are substitutes</td><td style="text-align: right">:subs_in_group</td><td style="text-align: right">No</td></tr><tr><td style="text-align: right">Products in different groups are substitutes</td><td style="text-align: right">:subs_across_group</td><td style="text-align: right">No</td></tr><tr><td style="text-align: right">Products in the same group are substitutes</td><td style="text-align: right">:complements_in_group</td><td style="text-align: right">No</td></tr><tr><td style="text-align: right">Products in different groups are substitutes</td><td style="text-align: right">:complements_across_group</td><td style="text-align: right">No</td></tr></table><h3 id="Linear-constraints"><a class="docs-heading-anchor" href="#Linear-constraints">Linear constraints</a><a id="Linear-constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Linear-constraints" title="Permalink"></a></h3><p>Our first constraint implementation is a linear constraints as developed by Compiani (2022). Each of these takes advantage of the fact that coefficients of Bernstein polynomials approximate values of the target function (the inverse demand function) on a known grid. As a result, we can easily impose some constraints, like monotonicity on the inverse demand function, by imposing linear relationships between sieve parameters. Constraints which fall into this category are denoted above in the <strong>Linear</strong> column</p><p>It is important to note that these linear constraints on our sieve parameters are, in general, <strong>necessary</strong> for the desired economic constraints to be satisfied by the resulting demand function, but not sufficient. However, they are much easier to impose than the more complex constraints we discuss below. In practice, we find that these linear constraints are often sufficient to provide reasonable orders of magnitude and relationships between products at the median, but insufficient for other moments of the elasticity distribution to be well-behaved. For more information, see discussions in Compiani (2022) and Brand and Smith (2024).</p><h3 id="Quasi-bayes-constraints-and-Sequentially-Constrained-Monte-Carlo-(SMC)"><a class="docs-heading-anchor" href="#Quasi-bayes-constraints-and-Sequentially-Constrained-Monte-Carlo-(SMC)">Quasi-bayes constraints and Sequentially Constrained Monte Carlo (SMC)</a><a id="Quasi-bayes-constraints-and-Sequentially-Constrained-Monte-Carlo-(SMC)-1"></a><a class="docs-heading-anchor-permalink" href="#Quasi-bayes-constraints-and-Sequentially-Constrained-Monte-Carlo-(SMC)" title="Permalink"></a></h3><p>&lt;!– #### Dogmatic Priors The first way we allow users to impose constraints using our quasi-Bayes approach is via a penalty term (the <code>penalty</code> argument in <code>estimate!</code>). The default value of this penalty is 0, but when the user increases this value, we evaluate a modified objective function. Rather than sampling according to the quasi-likelihood, we penalize that likelihood by the provided penalty:</p><pre><code class="language-julia hljs"># Turing.@addlogprob! (-0.5 * objective(...) - penalty)</code></pre><p>We find that this approach has an imperfect success rate. If multiple Markov chains are constructed for the same problem via this method, some may find the constrained space quickly and remain there, and others will never find the space even after many tens of thousands of samples. Still, we include this option because of its ease of use and its speed relative to our final approach below.  –&gt;</p><p>&lt;!– #### Sequentially Constrained Monte Carlo (SMC) –&gt;  Our more complex option for imposing constraints is implemented in the <code>smc!</code> function. This function implements &quot;Sequentially Constrained Monte Carlo,&quot; an iterative method which slowly reshapes an unconstrained Markov chain into a potentially complex constrained space. The approach is intutively simple. We specify an increasing sequence of penalty terms <span>$\lambda_i$</span>, which (after smoothing) define a sequence of posteriors <span>$\pi_i$</span> from which we can sample (with likelihood <span>$l_n$</span> and unconstrained posterior <span>$\bar\pi$</span>): </p><p class="math-container">\[\pi_0(\theta^*|\text{data})\propto e^{l_n(g^{-1}(\theta^*))} \bar{\pi}(\theta^*)\]</p><p class="math-container">\[\pi_1(\theta^*|\text{data})\propto e^{l_n(g^{-1}(\theta^*))} \bar{\pi}(\theta^*) \lVert\theta\rVert_\mathcal{C}^{\lambda_1}\]</p><p class="math-container">\[\pi_2(\theta^*|\text{data})\propto e^{l_n(g^{-1}(\theta^*))} \bar{\pi}(\theta^*) \lVert\theta\rVert_\mathcal{C}^{\lambda_2}\]</p><p>$</p><p>\vdots $  <span>$\pi_M(\theta^*|\text{data})\propto e^{l_n(g^{-1}(\theta^*))} \bar{\pi}(\theta^*) \lVert\theta\rVert_\mathcal{C}^{\lambda_M}$</span></p><p>We smooth the <span>$\lambda$</span> penalty terms via the following, where <span>$\Phi$</span> is the standard normal CDF:  <span>$||\theta||_\mathcal{C}^\lambda = \prod_{t=1}^T \Phi(-\lambda c_t(\theta))$</span></p><p>We define this sequence adaptively by default, though we offer users other options in the package. At each step in the sequence, we take a relatively small number of Metropolis-Hastings steps for each element of our chain (set by the user via <code>mh_steps</code>), sampling from the quasi-posterior corresponding to the next element <span>$\lambda_{i+1}$</span>. As we demonstrate in Brand and Smith (2024), appropriately defining this sequence allows us to enforce the desired constraints globally on our data. The corresponding cost is that this method is by far the most time consuming to run, often taking many minutes or even hours, depending on the problem&#39;s complexity. </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../priors/">« Quasibayes: Priors and Sampling</a><a class="docs-footer-nextpage" href="../usage/">Basic Usage (GMM) »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Friday 10 January 2025 04:40">Friday 10 January 2025</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
