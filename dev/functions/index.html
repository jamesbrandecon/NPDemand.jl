<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Function Documentation · NPDemand</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">NPDemand</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">NPDemand.jl</a></li><li><a class="tocitem" href="../details/">Implementation Details</a></li><li><a class="tocitem" href="../usage/">Usage</a></li><li><a class="tocitem" href="../postestimation/">Post-Estimation</a></li><li class="is-active"><a class="tocitem" href>Function Documentation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Function Documentation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Function Documentation</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jamesbrandecon/NPDemand.jl/blob/master/docs/src/functions.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Function-documentation"><a class="docs-heading-anchor" href="#Function-documentation">Function documentation</a><a id="Function-documentation-1"></a><a class="docs-heading-anchor-permalink" href="#Function-documentation" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="NPDemand.define_problem" href="#NPDemand.define_problem"><code>NPDemand.define_problem</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">define_problem(df::DataFrame; exchange = [], index_vars = [&quot;prices&quot;], FE = [], constraints = [], bO = 2, tol = 1e-5)</code></pre><p>Constructs a <code>problem</code>::NPDProblem using the provided problem characteristics. Inputs: </p><ul><li><code>exchange</code>: A vector of groups of products which are exchangeable. E.g., with 4 goods, if the first</li></ul><p>and second are exchangeable and so are the third and fourth, set <code>exchange</code> = [[1 2], [3 4]].</p><ul><li><code>index_vars</code>: String array listing column names in <code>df</code> which represent variables that enter the inverted index.<ul><li>&quot;prices&quot; must be the first element of <code>index_vars</code></li></ul></li><li><code>FE</code>: String array listing column names in <code>df</code> which should be included as fixed effects.<ul><li>Note: All fixed effects are estimated as parameters by the minimizer, so be careful adding fixed effects for variables that take many values.</li></ul></li><li><code>bO</code>: Order of the univariate Bernstein polynomials in market shares. Default is 2.</li><li><code>constraint_tol</code>: Tolerance specifying tightness of constraints</li><li><code>obj_xtol</code>: Tolerance specifying x_tol in Optim.Options()</li><li><code>obj_ftol</code>: Tolerance specifying f_tol in Optim.Options()</li><li><code>chunk_size</code>: Controls chunk size in ForwardDiff.Gradient autodiff calculation for nonlinear constraints. Only used if :subs_in_group specified. </li><li><code>constraints</code>: A list of symbols of accepted constraints. Currently supported constraints are: <ul><li>:monotone  </li><li>:all_substitutes </li><li>:diagonal_dominance_group </li><li>:diagonal_dominance_all </li><li>:subs_in_group (Note: this constraint is the only available nonlinear constraint and will slow down estimation considerably)</li></ul></li><li><code>verbose</code>: if <code>false</code>, will not print updates as problem is generated</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jamesbrandecon/NPDemand.jl/blob/b41ec0c9230d75f3c7df56ed0b05ceed4c7a7fa4/src/define_problem.jl#L1-L24">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="NPDemand.update_constraints!" href="#NPDemand.update_constraints!"><code>NPDemand.update_constraints!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">update_constraints!(problem::NPDProblem, new_constraints::Vector{Symbol})</code></pre><p>Re-calculates constraint matrices under <code>new_constraints</code>, ignoring previous constraints used to define the problem. The <code>exchangeability</code> constraint is an exception. To change anything about the structure of exchangeability for the problem changes, define a new problem.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jamesbrandecon/NPDemand.jl/blob/b41ec0c9230d75f3c7df56ed0b05ceed4c7a7fa4/src/define_problem.jl#L223-L228">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="NPDemand.estimate!" href="#NPDemand.estimate!"><code>NPDemand.estimate!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">estimate!(problem::NPDProblem; max_iterations = 10000, show_trace = false, chunk_size = Int[])</code></pre><p><code>estimate!</code> solves <code>problem</code> subject to provided constraints, and replaces <code>problem.results</code> with the resulting parameter vector. To enforce constraints, we iteratively minimize the sum of the objective function and a penalty term capturing violations of the constraint.  For each outer iteration, we increase the size of the penalty term by an order of magnitude.  </p><p>Options: </p><ul><li><code>max_inner_iterations</code>: controls the number of inner iterations for each call to the optimizer via Optim.jl</li><li><code>max_outer_iterations</code>: controls the number of total calls to Optim, i.e., the number of times the penalty enforcing the constraints will increase before exiting</li><li><code>show_trace</code>: if <code>true</code>, Optim will print the trace for each outer iteration. </li><li><code>verbose</code>: if <code>false</code>, will not print outer iteration updates within optimization</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jamesbrandecon/NPDemand.jl/blob/b41ec0c9230d75f3c7df56ed0b05ceed4c7a7fa4/src/estimate.jl#L1-L13">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="NPDemand.price_elasticities!" href="#NPDemand.price_elasticities!"><code>NPDemand.price_elasticities!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">price_elasticities!(problem::NPDProblem)</code></pre><p>Takes the solved <code>problem</code> as first argument, a <code>DataFrame</code> as the second argument, and evaluates all price elasticities in-sample.  Currently does not calculate out-of-sample price elasticities. For this, use the function <code>compute_demand_function!</code>. </p><p>Results of this function are stored as a <code>DataFrame</code> in problem.all<em>elasticities. Results can be summarized by hand or using the `summarize</em>elasticities` function.  We also store the Jacobian of the demand function with respect to prices, which can be used to calculate other quantities of interest.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jamesbrandecon/NPDemand.jl/blob/b41ec0c9230d75f3c7df56ed0b05ceed4c7a7fa4/src/price_elasticity.jl#L1-L9">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="NPDemand.compute_demand_function!" href="#NPDemand.compute_demand_function!"><code>NPDemand.compute_demand_function!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">compute_demand_function!(problem, df; max_iter = 1000, show_trace = false)</code></pre><p><code>compute_demand_function!</code> estimates the demand function/curve using NPD estimates calculated via estimate!.</p><p>The function takes in an estimated problem::NPDProblem and a dataframe with counterfactual values of the  covariates in the utility function. One must specify all fields that were used in estimation (including shares). The function will change the values of df[!,r&quot;shares&quot;] to take on the value of the estimated demand function.</p><p>Options: </p><ul><li><code>max_iter</code>: controls the number of iterations for the nonlinear solver calculating market shares. Default is 1000 but well-estimated problems should converge faster.</li><li><code>show_trace</code>: if <code>true</code>, Optim will print the trace for each iteration of the nonlinear solver. </li><li><code>compute_own_elasticities</code>: NOT yet implemented– if <code>true</code>, will also generate columns called <code>own_elast</code> which will include estimated own-price elasticities at all counterfactual points.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jamesbrandecon/NPDemand.jl/blob/b41ec0c9230d75f3c7df56ed0b05ceed4c7a7fa4/src/compute_demand_function.jl#L1-L14">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../postestimation/">« Post-Estimation</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 1 September 2023 16:46">Friday 1 September 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
